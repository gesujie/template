<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
<!-- 
    <link rel="stylesheet" type="text/css" href="http://www.jeasyui.com/easyui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="http://www.jeasyui.com/easyui/themes/icon.css">
    <script type="text/javascript" src="http://www.jeasyui.com/easyui/jquery.min.js"></script>
    <script type="text/javascript" src="http://www.jeasyui.com/easyui/jquery.easyui.min.js"></script> -->

    <link href="../assets/stylesheets/application.css" rel="stylesheet" type="text/css" />
    <script src="../assets/javascripts/vendor/jquery-2.1.3.min.js" type="text/javascript"></script>
    <script src="../assets/javascripts/vendor/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="../assets/javascripts/main.js" type="text/javascript"></script>

</head>
<body>
<div class="easyui-layout" fit="true">
    <!-- 中部展示区域 -->
    <div class="easyui-layout" fit="true">
        <div data-options="region:'north',cls:'layout-panel panel-primary',title:'系统用户查询'" style="height:105px;">

            <!-- 搜索表单 -->
            <form class="form-inline" id="qc-adminMngUser-searchForm">
                <div class='form-group'>
                    <label>用户名:</label>
                    <input class='form-control easyui-textbox' id="qc-adminMngUser-comboDeptSh" name="deptId" data-options='height:32, width:100'>
                </div>
                <div class='form-group'>
                    <label>手机号:</label>
                    <input class='form-control easyui-textbox' name="userTel" data-options='height:32, width:100'>
                </div>
                <div class='form-group'>
                    <label>邮箱:</label>
                    <input class='form-control easyui-textbox' name="userEmil" data-options='height:32, width:100'>
                </div>
                <a iconcls="fa fa-search" class="easyui-linkbutton color-default" onclick="qc.adminMngUser.search();" href="javascript:void(0)">查询</a>
                <a iconcls="fa fa-undo" class="easyui-linkbutton color-default" onclick="qc.adminMngUser.searchReset();" href="javascript:void(0)">重置</a>
                <a iconcls="fa fa-plus" class="easyui-linkbutton color-default" onclick="qc.adminMngUser.add();" href="javascript:void(0)">新增</a>
                <a iconcls="fa fa-plus" class="easyui-linkbutton color-default" id="qc-adminMngUser-btnRemove" onclick="qc.adminMngUser.remove();" href="javascript:void(0)" style="display:none;">删除</a>
            </form>
        </div>

        <!-- 列表生成区域 -->
        <div data-options="region:'center'">
            <table id="qc-adminMngUser-dgUser"></table>
        </div>
    </div>
</div>

<!-- 右方编辑侧边栏 -->
<div id="qc-adminMngUser-dlgUserEdit">
    <form class='form-horizontal' id="qc-adminMngUser-editForm">
        <input type="hidden" name="userId">
        <div class='form-group'>
            <label class="col-3 control-label">用户名：</label>
            <div class="col-9 col-last">
                <input class='form-control easyui-textbox' name="username" data-options='width:180, height:32, prompt: "请输入用户名"'>
            </div>
        </div>
        <div class='form-group'>
            <label class="col-3 control-label">密码：</label>
            <div class="col-9 col-last">
                <input class='form-control easyui-textbox' name="password" data-options='width:180, height:32, prompt: "请输入密码，不修改请留空"'>
            </div>
        </div>
        <div class='form-group'>
            <label class="col-3 control-label">确认密码：</label>
            <div class="col-9 col-last">
                <input class='form-control easyui-textbox' name="password2" data-options='width:180, height:32, prompt: "请再次输入密码，不修改请留空"'>
            </div>
        </div>
        <div class='form-group'>
            <label class="col-3 control-label">注册邮箱：</label>
            <div class="col-9 col-last">
                <input class='form-control easyui-textbox' name="userEmil" data-options='width:180, height:32, prompt: "请输入用户名"'>
            </div>
        </div>
        <div class='form-group'>
            <label class="col-3 control-label">注册手机：</label>
            <div class="col-9 col-last">
                <input class='form-control easyui-textbox' name="userTel" data-options='width:180, height:32, prompt: "请输入用户名"'>
            </div>
        </div>
        <div class='form-group'>
            <label class="col-3 control-label">锁定状态：</label>
            <div class="col-9 col-last" style="padding-top: 7px;">
                <label for="lockState-1">启用</label>
                <input type="radio" name="lockState" value="1" id="lockState-1"/>
                <label for="lockState-2">锁定</label>
                <input type="radio" name="lockState" value="0" id="lockState-2"/>
            </div>
        </div>
        
        <div class='form-group'>
            <div class="col-9 col-last">
                <a iconcls="fa fa-save" class="easyui-linkbutton color-default" onclick="qc.adminMngUser.save();" href="javascript:void(0)">保存</a>
                <a iconcls="fa fa-undo" class="easyui-linkbutton color-default" onclick="qc.adminMngUser.dlgUserEdit.dialog('close');" href="javascript:void(0)">取消</a>
            </div>
        </div>
    </form>
</div>

<script>
$(function() {
// 注册本页命名空间
Namespace.register("qc.adminMngUser");

// 默认datagrid查询函数，用于初始化查询
qc.adminMngUser.defaultSearchParams = {
    deptId: "00010001001"
};

// 初始化列表
qc.adminMngUser.dgUser = $("#qc-adminMngUser-dgUser").datagrid({
    data: [{id: 1, username: "dg19991", userEmil: "dg19991@dydw.com", userTel: "13984842424", linkEmpId: "dg19991", /*linkEmpName: "张三",*/ lastLogintime: 130234204, lastLoginip: "10.113.125.107", lockState: 1},{id: 2, username: "dg19990", userEmil: "dg19990@dydw.com", userTel: "13984842424", linkEmpId: "dg19990", linkEmpName: "李四", lastLogintime: 130234204, lastLoginip: "10.113.125.107", lockState: 0}],
    queryParams: qc.adminMngUser.defaultSearchParams,
    cls: "panel-primary",
    title: "系统用户列表",
    pagination: true,
    fit: true,
    columns:[[    
        {field: 'id', checkbox: true},
        {field: 'username',title: '用户名', width:100, align: 'center'},
        {field: 'userEmil',title: '邮箱', width:140, align: 'center'},
        {field: 'userTel',title: '手机号', width:140, align: 'center'},
        {field: 'linkEmpId',title: '关联人员', width:100, align: 'center',
            formatter: function(value,row,index){
                return row.linkEmpName;
            }
        },
        {field: 'lastLogintime',title: '最后登陆时间', width:120, align: 'center',
            formatter: function(value,row,index){
                return moment(value).format("YYYY-MM-DD hh:mm");
            }
        },
        {field: 'lastLoginip',title: '最后登陆IP', width:100, align: 'center'},
        {field: 'lockState',title: '锁定状态', width:80, align: 'center',
            formatter: function(value,row,index){
                return value == 1 ? "启用用户" : "锁定用户";
            }
        },
        {field: 'operationColumn',title: '操作列', width:100, align: 'center',
            formatter: function(value,row,index){
                return "<button class='fa fa-edit fa-dgBtn' title='编辑' "
                    +  "onclick='qc.adminMngUser.edit(" + index + ");'></button>"
                    +  "<button class='fa fa-remove fa-dgBtn' title='删除' "
                    +  "onclick='qc.adminMngUser.remove(" + index + ");'></button>";
            }
        }
    ]],
    onClickRow : function() {qc.adminMngUser.toggleRemoveButton();},
    onSelectAll : function() {qc.adminMngUser.toggleRemoveButton();},
    onUnselectAll : function() {qc.adminMngUser.toggleRemoveButton();}

});

// 初始化编辑表单、搜索表单
qc.adminMngUser.editForm = $("#qc-adminMngUser-editForm").form();
qc.adminMngUser.searchForm = $("#qc-adminMngUser-searchForm").form();

// 添加函数
qc.adminMngUser.add = function() {
    qc.adminMngUser.editForm.form("clear");
    qc.adminMngUser.openDialog();
};

// 编辑行，如果没有提供行，进行相应提示
qc.adminMngUser.edit = function(index) {
    if(index > -1) {
        qc.adminMngUser.editForm.form("clear");
        qc.adminMngUser.dgUser.datagrid("selectRow", index);
        var row = qc.adminMngUser.dgUser.datagrid("getSelected");
        qc.adminMngUser.editForm.form("load", row);
        qc.adminMngUser.openDialog();
    } else {
        $.showMessage({msg:"请选择一行数据进行编辑"});
        return;
    }
};

// 删除函数
qc.adminMngUser.remove = function(index) {
    qc.adminMngUser.editForm.form("clear");
    if(index > -1) {
        qc.adminMngUser.dgUser.datagrid("selectRow", index);
    }
    var rows = qc.adminMngUser.dgUser.datagrid("getSelections");

    // 通过选择的行，遍历拼接id字符串，一次性传输到后台
    if(rows.length > 0) {
        var idArray = [],
            idString = "";
        for(var i=0; i<rows.length; i++) {
            idArray.push(rows[i].id);
        }
        idString = idArray.join(",");
        
        console.info("要删除的id为：" + idString);

        $.post("", {"removeIds": idString}, function(json) {
            if(json.success) {
                qc.adminMngUser.dgUser.datagrid("refresh");
            } else {
                $.showMessage({msg:"删除失败，原因：" + json.msg});
            }
        }, "json");
    } else {
        $.showMessage({msg:"请选择需要删除的行"});
        return;
    }
};

qc.adminMngUser.openDialog = function() {
    if(!!qc.adminMngUser.dlgUserEdit) {
        qc.adminMngUser.dlgUserEdit.dialog("open");
    } else {
        qc.adminMngUser.dlgUserEdit = $("#qc-adminMngUser-editForm").dialog({
            width: 300,
            height: 400,
            title: "系统用户信息编辑",
            cls: "panel-primary"
        });
    }
}

// 保存编辑表单
qc.adminMngUser.save = function() {
    // 序列化表单对象，根据id是否为空，判断提交地址
    var saveObj = $.serializeObject(qc.adminMngUser.editForm),
        saveUrl = saveObj.userId == "" ? "adminMng/user/add.do" : "adminMng/user/edit.do";

    // 提交编辑表单到后台
    $.post(saveUrl, saveObj, function(json) {
        if(json.success) {
            qc.adminMngUser.dgUser.datagrid("refresh");
            $.showMessage({msg:"保存成功！"});
        } else {
            $.showMessage({msg:"保存失败，原因：" + json.msg});
        }
    }, "json");
};

// 搜索函数，序列化表单，读取到datagrid中
qc.adminMngUser.search = function() {
    var searchObj = $.serializeObject(qc.adminMngUser.searchForm);
    console.info(searchObj);
    qc.adminMngUser.dgUser.datagrid("load", searchObj);
};

// 重置搜索函数
qc.adminMngUser.searchReset = function() {
    qc.adminMngUser.searchForm.form("clear");
    var searchObj = $.serializeObject(qc.adminMngUser.searchForm);
    qc.adminMngUser.dgUser.datagrid("load", qc.adminMngUser.defaultSearchParams);
};

qc.adminMngUser.toggleRemoveButton = function() {
    var rows = qc.adminMngUser.dgUser.datagrid("getSelections");
    if(!!qc.adminMngUser.btnRemove) {
        if(rows.length > 1) {
            qc.adminMngUser.btnRemove.show();
        } else {
            qc.adminMngUser.btnRemove.hide();
        }
    } else {
        qc.adminMngUser.btnRemove = $("#qc-adminMngUser-btnRemove");
    }
};

});
</script>


</body>
</html>