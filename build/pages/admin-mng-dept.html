<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <!-- <link rel="stylesheet" type="text/css" href="http://www.jeasyui.com/easyui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="http://www.jeasyui.com/easyui/themes/icon.css"> -->

<link href="../assets/stylesheets/application.css" rel="stylesheet" type="text/css" />
<script src="../assets/javascripts/vendor/jquery-2.1.3.min.js" type="text/javascript"></script>
<script src="../assets/javascripts/vendor/jquery.easyui.min.js" type="text/javascript"></script>
<script src="../assets/javascripts/main.js" type="text/javascript"></script>
<script src="../assets/javascripts/components/extEasyui/treegrid-dnd.js" type="text/javascript"></script>
</head>
<body>

<div class="easyui-layout" fit="true">
    <!-- 部门操作按钮 -->
    <div data-options="region:'north',cls:'panel-layout panel-primary',title:'部门信息编辑'" style="height:105px;">
        <a iconcls="fa fa-plus" class="easyui-linkbutton color-default" onclick="qc.adminMngDept.add();" href="javascript:void(0)">添加部门</a>
        <a iconcls="fa fa-edit" class="easyui-linkbutton color-default" onclick="qc.adminMngDept.edit();" href="javascript:void(0)">编辑部门</a>
        <a iconcls="fa fa-remove" class="easyui-linkbutton color-default" onclick="qc.adminMngDept.remove();" href="javascript:void(0)">删除部门</a>
    </div>

    <!-- 岗位列表 -->
    <div data-options="region:'east',cls:'panel-primary layout-panel pl-10',title:'拥有岗位列表'" style="width:300px; padding:0">
        <table id="qc-adminMngDept-dgPost"></table>
    </div>
    
    <!-- 部门树列表 -->
    <div data-options="region:'center'">
        <table id="qc-adminMngDept-tgDept"></table>
    </div> 
</div>

<!--  部门编辑对话框 -->
<div id="qc-adminMngDept-editDialog" style="display: none;">
    <form id="qc-adminMngDept-editForm">
        <div class='form-group'>
            <label>部门名称:</label>
            <input class='easyui-textbox' name="deptName" data-options='height:32,width:200'>
        </div>
        <div class='form-group'>
            <label>上级名称:</label>
            <input class='easyui-textbox' id="qc-adminMngDept-comboParent" name="deptPid" data-options='height:32,width:200'>
        </div>
    </form>
    <div id="qc-adminMngDept-editDialog-buttons">
        <a iconcls="fa fa-plus-square" class="easyui-linkbutton color-default" onclick="qc.adminMngDept.add();" href="javascript:void(0)">保存</a>
        <a iconcls="fa fa-plus-square" class="easyui-linkbutton color-default" onclick="qc.adminMngDept.editDialog.dialog('close');" href="javascript:void(0)">关闭</a>
    </div>
</div>


<script>

$(function() {
// 注册命名空间
Namespace.register("qc.adminMngDept");

// 初始化部门树
qc.adminMngDept.tgDept = $("#qc-adminMngDept-tgDept").treegrid({
    url: "../assets/javascripts/json/sidebarNav/deptAndPostData.json",
    cls: "panel-primary",
    title: "部门列表",
    fit: true,
    idField:'deptId',    
    treeField:'deptName',    
    parentField: "deptPid",
    columns:[[    
        {field: 'deptId', checkbox: true},
        {field: 'deptName',title: '部门名字', width:200, halign: 'center'},
        {field: 'deptPid',title: '上级名字', width:200, align: 'center',
            formatter: function(value, row, index) {
                // 需要后台查询将父级名字查询出来
                return value;
            }
        },
        {field: 'deptSort',title: '排序', width:60, align: 'center'},
        {field: 'dataOperate',title: '操作', width:100, align: 'center',
            formatter: function(value, row, index) {
                return '<button onclick="qc.adminMngDept.sortUp()"><i class="fa fa-arrow-up"></i></button>'
                    +  '<button onclick="qc.adminMngDept.sortDown()"><i class="fa fa-arrow-down"></i></button>'
                    +  '<button onclick="qc.adminMngDept.sortDown()"><i class="fa fa-share"></i></button>';

            }
        },

    ]]
});

// 初始化岗位列表
qc.adminMngDept.dgPost = $("#qc-adminMngDept-dgPost").datagrid({
    data: [{postId: 1, deptId: 1, postName: "所长"},
           {postId: 1, deptId: 1, postName: "主任"},
           {postId: 1, deptId: 1, postName: "业务员"}],
    fit: true,
    idField:'postId',    
    columns:[[    
        {field: 'postId', checkbox: true},
        {field: 'postName',title: '岗位名字', width:100, halign: 'center'},
        {field: 'dataOperate',title: '操作', width:130, align: 'center',
            formatter: function(value, row, index) {
                return '<button onclick="qc.adminMngDept.sortUp()"><i class="fa fa-arrow-up"></i></button>'
                    +  '<button onclick="qc.adminMngDept.sortDown()"><i class="fa fa-arrow-down"></i></button>'
                    +  '<button onclick=""><i class="fa fa-edit"></i></button>'
                    +  '<button onclick=""><i class="fa fa-remove"></i></button>';
            }
        },

    ]]
});

// 初始化form表单
qc.adminMngDept.editForm = $("#qc-adminMngDept-editForm").form();

// 初始化编辑对话框中的父级下拉树
qc.adminMngDept.comboParent = $("#qc-adminMngDept-comboParent").combotree({
    valueField:'deptId',    
    textField:'deptName',    
    parentField: "deptPid"
});

// 排序上移
qc.adminMngDept.sortUp = function() {

};

// 排序下移
qc.adminMngDept.sortDown = function() {

};

// 添加功能
qc.adminMngDept.add = function() {
    qc.adminMngDept.editForm.form("clear");

    var node = qc.adminMngDept.tgDept.treegrid("getSelected"),
        loadData = {deptType: 1};
    if(!!node) {
        loadData.deptPid = node.id;
    }
    qc.adminMngDept.editForm.form("load", loadData);
    qc.adminMngDept.openDialog();
};

// 编辑功能
qc.adminMngDept.edit = function() {
    qc.adminMngDept.editForm.form("clear");

    var node = qc.adminMngDept.tgDept.treegrid("getSelected");
    if(!!node) {
        qc.adminMngDept.editForm.form("load", node);
        qc.adminMngDept.openDialog();
    } else {
        $.showMessage({msg:"请先选择需要编辑的数据"});
    }

};

// 删除节点
qc.adminMngDept.remove = function() {
    var node = qc.adminMngDept.tgDept.treegrid("getSelected");
    if(!!node) {
        



    } else {
        $.showMessage({msg:"请先选择需要编辑的数据"});
    }
};

// 打开对话框
qc.adminMngDept.openDialog = function() {
    // 打开窗口之前，把列表中的树加载到对话框中
    qc.adminMngDept.comboParent.combotree("loadData", qc.adminMngDept.tgDept.treegrid("getData"));

    // 判断窗口是否初始化过
    if(!!qc.adminMngDept.editDialog) {
        qc.adminMngDept.editDialog.dialog("open");
    } else {
        qc.adminMngDept.editDialog = $("#qc-adminMngDept-editDialog").show().dialog({
            cls: "panel-primary",
            title: "菜单信息编辑",
            width: 300,
            height: 400,
            buttons: "#qc-adminMngDept-editDialog-buttons"
        });
    }
};

// 提交数据表单
qc.adminMngDept.submitForm = function() {
    var formData = $.serializeObject(qc.adminMngDept.editForm);
    if(qc.adminMngDept.editForm("validate")) {

    } else {

    }
};

});

</script>


</body>
</html>
