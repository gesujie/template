!function(e){e(function(){function a(a){var t=e('<li id="'+a.id+'"><p class="title">'+a.name+'</p><p class="imgWrap"></p><p class="progress"><span></span></p></li>'),i=e('<div class="file-panel"><span class="cancel">\u5220\u9664</span><span class="rotateRight">\u5411\u53f3\u65cb\u8f6c</span><span class="rotateLeft">\u5411\u5de6\u65cb\u8f6c</span></div>').appendTo(t),s=t.find("p.progress span"),n=t.find("p.imgWrap"),r=e('<p class="error"></p>'),d=function(e){switch(e){case"exceed_size":text="\u6587\u4ef6\u5927\u5c0f\u8d85\u51fa";break;case"interrupt":text="\u4e0a\u4f20\u6682\u505c";break;default:text="\u4e0a\u4f20\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5"}r.text(text).appendTo(t)};"invalid"===a.getStatus()?d(a.statusText):(n.text("\u9884\u89c8\u4e2d"),o.makeThumb(a,function(a,t){var i;return a?void n.text("\u4e0d\u80fd\u9884\u89c8"):void(x?(i=e('<img src="'+t+'">'),n.empty().append(i)):e.ajax("../../server/preview.php",{method:"POST",data:t,dataType:"json"}).done(function(a){a.result?(i=e('<img src="'+a.result+'">'),n.empty().append(i)):n.text("\u9884\u89c8\u51fa\u9519")}))},b,g),k[a.id]=[a.size,0],a.rotation=0),a.on("statuschange",function(e,n){"progress"===n?s.hide().width(0):"queued"===n&&(t.off("mouseenter mouseleave"),i.remove()),"error"===e||"invalid"===e?(console.log(a.statusText),d(a.statusText),k[a.id][1]=1):"interrupt"===e?d("interrupt"):"queued"===e?k[a.id][1]=0:"progress"===e?(r.remove(),s.css("display","block")):"complete"===e&&t.append('<span class="success"></span>'),t.removeClass("state-"+n).addClass("state-"+e)}),t.on("mouseenter",function(){i.stop().animate({height:30})}),t.on("mouseleave",function(){i.stop().animate({height:0})}),i.on("click","span",function(){var t,i=e(this).index();switch(i){case 0:return void o.removeFile(a);case 1:a.rotation+=90;break;case 2:a.rotation-=90}A?(t="rotate("+a.rotation+"deg)",n.css({"-webkit-transform":t,"-mos-transform":t,"-o-transform":t,transform:t})):n.css("filter","progid:DXImageTransform.Microsoft.BasicImage(rotation="+~~(a.rotation/90%4+4)%4+")")}),t.appendTo(l)}function t(a){var t=e("#"+a.id);delete k[a.id],i(),t.off().find(".file-panel").off().end().remove()}function i(){var a,t=0,i=0,n=f.children();e.each(k,function(e,a){i+=a[0],t+=a[0]*a[1]}),a=i?t/i:0,n.eq(0).text(Math.round(100*a)+"%"),n.eq(1).css("width",Math.round(100*a)+"%"),s()}function s(){var e,a="";"ready"===w?a="\u9009\u4e2d"+m+"\u5f20\u56fe\u7247\uff0c\u5171"+WebUploader.formatSize(h)+"\u3002":"confirm"===w?(e=o.getStats(),e.uploadFailNum&&(a="\u5df2\u6210\u529f\u4e0a\u4f20"+e.successNum+"\u5f20\u7167\u7247\u81f3XX\u76f8\u518c\uff0c"+e.uploadFailNum+'\u5f20\u7167\u7247\u4e0a\u4f20\u5931\u8d25\uff0c<a class="retry" href="#">\u91cd\u65b0\u4e0a\u4f20</a>\u5931\u8d25\u56fe\u7247\u6216<a class="ignore" href="#">\u5ffd\u7565</a>')):(e=o.getStats(),a="\u5171"+m+"\u5f20\uff08"+WebUploader.formatSize(h)+"\uff09\uff0c\u5df2\u4e0a\u4f20"+e.successNum+"\u5f20",e.uploadFailNum&&(a+="\uff0c\u5931\u8d25"+e.uploadFailNum+"\u5f20")),c.html(a)}function n(a){var t;if(a!==w){switch(p.removeClass("state-"+w),p.addClass("state-"+a),w=a){case"pedding":u.removeClass("element-invisible"),l.hide(),d.addClass("element-invisible"),o.refresh();break;case"ready":u.addClass("element-invisible"),e("#filePicker2").removeClass("element-invisible"),l.show(),d.removeClass("element-invisible"),o.refresh();break;case"uploading":e("#filePicker2").addClass("element-invisible"),f.show(),p.text("\u6682\u505c\u4e0a\u4f20");break;case"paused":f.show(),p.text("\u7ee7\u7eed\u4e0a\u4f20");break;case"confirm":if(f.hide(),e("#filePicker2").removeClass("element-invisible"),p.text("\u5f00\u59cb\u4e0a\u4f20"),t=o.getStats(),t.successNum&&!t.uploadFailNum)return void n("finish");break;case"finish":t=o.getStats(),t.successNum?alert("\u4e0a\u4f20\u6210\u529f"):(w="done",location.reload())}s()}}var o,r=e("#uploader"),l=e('<ul class="filelist"></ul>').appendTo(r.find(".queueList")),d=r.find(".statusBar"),c=d.find(".info"),p=r.find(".uploadBtn"),u=r.find(".placeholder"),f=d.find(".progress").hide(),m=0,h=0,v=window.devicePixelRatio||1,b=110*v,g=110*v,w="pedding",k={},x=function(){var e=new Image,a=!0;return e.onload=e.onerror=function(){(1!=this.width||1!=this.height)&&(a=!1)},e.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",a}(),y=function(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(a){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(t){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1],10)}(),A=function(){var e=document.createElement("p").style,a="transition"in e||"WebkitTransition"in e||"MozTransition"in e||"msTransition"in e||"OTransition"in e;return e=null,a}();return!WebUploader.Uploader.support("flash")&&WebUploader.browser.ie?void(y?!function(e){window.expressinstallcallback=function(e){switch(e){case"Download.Cancelled":alert("\u60a8\u53d6\u6d88\u4e86\u66f4\u65b0\uff01");break;case"Download.Failed":alert("\u5b89\u88c5\u5931\u8d25");break;default:alert("\u5b89\u88c5\u5df2\u6210\u529f\uff0c\u8bf7\u5237\u65b0\uff01")}delete window.expressinstallcallback};var a="./expressInstall.swf",t='<object type="application/x-shockwave-flash" data="'+a+'" ';WebUploader.browser.ie&&(t+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),t+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+a+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',e.html(t)}(r):r.html('<a href="http://www.adobe.com/go/getflashplayer" target="_blank" border="0"><img alt="get flash player" src="http://www.adobe.com/macromedia/style_guide/images/160x41_Get_Flash_Player.jpg" /></a>')):WebUploader.Uploader.support()?(o=WebUploader.create({pick:{id:"#filePicker",label:"\u70b9\u51fb\u9009\u62e9\u56fe\u7247"},formData:{uid:123},dnd:"#dndArea",paste:"#uploader",swf:"../../dist/Uploader.swf",chunked:!1,chunkSize:524288,server:"../../server/fileupload.php",disableGlobalDnd:!0,fileNumLimit:300,fileSizeLimit:209715200,fileSingleSizeLimit:52428800}),o.on("dndAccept",function(e){for(var a=!1,t=e.length,i=0,s="text/plain;application/javascript ";t>i;i++)if(~s.indexOf(e[i].type)){a=!0;break}return!a}),o.on("dialogOpen",function(){console.log("here")}),o.addButton({id:"#filePicker2",label:"\u7ee7\u7eed\u6dfb\u52a0"}),o.on("ready",function(){window.uploader=o}),o.onUploadProgress=function(a,t){var s=e("#"+a.id),n=s.find(".progress span");n.css("width",100*t+"%"),k[a.id][1]=t,i()},o.onFileQueued=function(e){m++,h+=e.size,1===m&&(u.addClass("element-invisible"),d.show()),a(e),n("ready"),i()},o.onFileDequeued=function(e){m--,h-=e.size,m||n("pedding"),t(e),i()},o.on("all",function(e){switch(e){case"uploadFinished":n("confirm");break;case"startUpload":n("uploading");break;case"stopUpload":n("paused")}}),o.onError=function(e){alert("Eroor: "+e)},p.on("click",function(){return e(this).hasClass("disabled")?!1:void("ready"===w?o.upload():"paused"===w?o.upload():"uploading"===w&&o.stop())}),c.on("click",".retry",function(){o.retry()}),c.on("click",".ignore",function(){alert("todo")}),p.addClass("state-"+w),void i()):void alert("Web Uploader \u4e0d\u652f\u6301\u60a8\u7684\u6d4f\u89c8\u5668\uff01")})}(jQuery);