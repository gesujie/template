Namespace.register("qc.main"),qc.main.onlyOpenTitle="\u6b22\u8fce\u4f7f\u7528",qc.main.mainTabs=null,qc.main.windowStack=[],$(function(){qc.main.slideMenuUrl&&null!=qc.main.slideMenuUrl||(qc.main.slideMenuUrl="json/mainMenuTreeData.json"),qc.main.slideMenu=$("#mainSlideMenu").tree({url:qc.main.slideMenuUrl,fit:!0,animate:!0,parentField:"parentId",onClick:function(n){n.children?qc.main.slideMenu.tree("toggle",n.target):n.url&&qc.main.addTab(n.text,n.url,n.iconCls,!!n.iframe)},onLoadSuccess:function(){$("#mainSlideMenu .tree-hit").before('<span class="tree-indent"></span>')}}),qc.main.mainTabs=$("#mainTabs").tabs({border:!1,fit:!0,tabHeight:41,onClose:function(n){qc.main.destroyContainsWindow(n)},onSelect:function(){$(".combo-p").hide()}})}),qc.main.getIcon=function(n){var a="";return $.each(_menus,function(e,i){$.each(i.children,function(e,i){i.id==n&&(a=i.iconCls)})}),a},qc.main.find=function(n){var a=null;return $.each(_menus,function(e,i){$.each(i.children,function(e,i){i.id==n&&(a=i)})}),a},qc.main.addTab=function(n,a,e,i){var t=null;if(qc.main.mainTabs.tabs("exists",n)){qc.main.mainTabs.tabs("select",n);var s=qc.main.mainTabs.tabs("getTab",n).find("iframe").attr("src");t=qc.main.mainTabs.tabs("getSelected"),s!=a&&qc.main.mainTabs.tabs("update",{tab:t,options:{content:i?qc.main.createFrame(a):null,href:i?null:a,icon:e}})}else qc.main.mainTabs.tabs("add",{title:n,content:i?qc.main.createFrame(a):null,href:i?null:a,closable:!0,icon:e}),t=qc.main.mainTabs.tabs("getSelected");i&&null!=t&&(t.css("overflow","hidden"),t.iframe=i),qc.main.tabClose(),qc.main.tabCloseEven()},qc.main.createFrame=function(n){var a='<iframe scrolling="auto" src="'+n+'" style="width:100%;height:100%;"></iframe>';return a};var mainTabMenu=$("#mainTabMenu");qc.main.tabClose=function(){var n=$(".tabs-inner"),a=$(".tabs-selected");n.dblclick(function(){var n=$(this).children(".tabs-closable").text();qc.main.mainTabs.tabs("close",n)}),n.mousedown(function(n){if(n.preventDefault(),2==n.which){var a=$(this).children(".tabs-closable").text();return qc.main.mainTabs.tabs("close",a),!1}}),a.mousedown(function(n){if(n.preventDefault(),2==n.which){var a=$(this).children().first().text();return qc.main.mainTabs.tabs("close",a),!1}return!1}),a.bind("contextmenu",function(n){mainTabMenu.menu("show",{left:n.pageX,top:n.pageY});var a=$(this).children().first().text();return mainTabMenu.data("currtab",a),qc.main.mainTabs.tabs("select",a),!1})},qc.main.tabCloseEven=function(){return mainTabMenu.menu({onClick:function(n){qc.main.closeTab(n.id)}}),!1},qc.main.pushWindowId=function(n){qc.main.windowStack.push({title:qc.main.mainTabs.tabs("getSelected").panel("options").title,windows:n.split(",")})},qc.main.destroyContainsWindow=function(n){var a=new Array,e=qc.main.windowStack;if(n&&n.length>0){for(var i=0;i<e.length;i++)if(n.indexOf(e[i].title)>-1)for(var t=e[i].windows,s=0;s<t.length;s++){var c=$("#"+t[s]);c&&(qc.main.destoryWindow=c,c.panel("destroy"))}else a.push(e[i]);qc.main.windowStack=a}},qc.main.closeTab=function(n){var a=qc.main.mainTabs.tabs("tabs"),e=qc.main.mainTabs.tabs("getSelected"),i=e.panel("options").title,t=[],s=[];switch($.each(a,function(n,a){t.push($(a).panel("options").title)}),n){case"refresh":var c;if(i!=qc.main.onlyOpenTitle)if(c=e.children("iframe").src,null!=c&&c.length>0)qc.main.mainTabs.tabs("update",{tab:e,options:{content:e.iframe?qc.main.createFrame(c):null}});else{var l=qc.main.mainTabs.tabs("getSelected");s.push(i),l.panel("refresh")}break;case"close":i!=qc.main.onlyOpenTitle&&(s.push(i),qc.main.mainTabs.tabs("close",i));break;case"closeall":$.each(t,function(n,a){a!=qc.main.onlyOpenTitle&&(qc.main.mainTabs.tabs("close",a),s.push(a))});break;case"closeother":$.each(t,function(n,a){a!=i&&a!=qc.main.onlyOpenTitle&&(qc.main.mainTabs.tabs("close",a),s.push(a))});break;case"closeright":var r=qc.main.mainTabs.tabs("getTabIndex",e);if(r==a.length-1)return $.messager.show({title:"\u63d0\u793a",msg:"\u53f3\u8fb9\u6ca1\u6709\u53ef\u5173\u95ed\u7684\u6807\u7b7e\uff01",timeout:5e3,showType:"slide"}),!1;$.each(t,function(n,a){n>r&&a!=qc.main.onlyOpenTitle&&(qc.main.mainTabs.tabs("close",a),s.push(a))});break;case"closeleft":var r=qc.main.mainTabs.tabs("getTabIndex",e);if(1==r)return $.messager.show({title:"\u63d0\u793a",msg:"\u5de6\u8fb9\u6ca1\u6709\u53ef\u5173\u95ed\u7684\u6807\u7b7e\uff01",timeout:5e3,showType:"slide"}),!1;$.each(t,function(n,a){r>n&&a!=qc.main.onlyOpenTitle&&(qc.main.mainTabs.tabs("close",a),s.push(a))})}qc.main.destroyContainsWindow(s)},qc.main.menushow=function(n){var a=$(".menu > li");$("#"+n.id).addClass("active"),$("div."+n.id).fadeIn();var e=$("div."+n.id+" > iframe").attr("src");(""==e||"#"==e)&&(durl=$("div."+n.id).attr("title"),$("div."+n.id+" > iframe").attr("src",durl));for(var i=0;i<a.length;i++){var t=a[i].id;n.id!=t&&($("#"+t).removeClass("active"),$("div."+t).css("display","none"))}},qc.main.closeThisAndsOpenOther=function(n,a,e){if(qc.main.mainTabs.tabs("exists",a)){qc.main.mainTabs.tabs("close",n),qc.main.mainTabs.tabs("select",a);var i=qc.main.mainTabs.tabs("getSelected"),t=$(i.panel("options").content);src=t.attr("src"),src!=e&&qc.main.mainTabs.tabs("update",{tab:i,options:{content:qc.main.createFrame(e)}})}else{var s=qc.main.mainTabs.tabs("getSelected");qc.main.mainTabs.tabs("update",{tab:s,options:{title:a,content:qc.main.createFrame(e)}})}},qc.main.getCurrentWindow=function(n){var a=n,e=n.lastIndexOf(".");return-1!=e&&(a=n.substring(0,e)),frames[a]},qc.main.msgShow=function(n,a,e){$.messager.alert(n,a,e)};