Namespace.register("qc.main"),qc.main.onlyOpenTitle="\u6b22\u8fce\u4f7f\u7528",qc.main.mainTabs=null,qc.main.windowStack=[],$(function(){qc.main.slideMenuUrl&&null!=qc.main.slideMenuUrl||(qc.main.slideMenuUrl="/assets/javascripts/json/sidebarNav/mainMenuTreeData.json"),qc.main.slideMenu=$("#mainSlideMenu").tree({url:qc.main.slideMenuUrl,method:"get",fit:!0,animate:!0,parentField:"parentId",onClick:function(a){a.children?qc.main.slideMenu.tree("toggle",a.target):a.url&&qc.main.addTab(a.text,a.url,a.iconCls,!!a.iframe)},formatter:function(a){var n=a.text;return a.children&&(n+="<span class='badge badge-fw badge-warning'>"+a.children.length+"</span>"),n}}),qc.main.mainTabs=$("#mainTabs").tabs({border:!1,fit:!0,tabHeight:40})}),qc.main.getIcon=function(a){var n="";return $.each(_menus,function(e,i){$.each(i.children,function(e,i){i.id==a&&(n=i.iconCls)})}),n},qc.main.find=function(a){var n=null;return $.each(_menus,function(e,i){$.each(i.children,function(e,i){i.id==a&&(n=i)})}),n},qc.main.addTab=function(a,n,e,i){var t=null;if(qc.main.mainTabs.tabs("exists",a)){qc.main.mainTabs.tabs("select",a);var s=qc.main.mainTabs.tabs("getTab",a).find("iframe").attr("src");t=qc.main.mainTabs.tabs("getSelected"),s!=n&&qc.main.mainTabs.tabs("update",{tab:t,options:{content:i?qc.main.createFrame(n):null,href:i?null:n}})}else qc.main.mainTabs.tabs("tabs").length>=6?$.messager.show({title:"\u63d0\u9192",msg:"\u6253\u5f00\u7a97\u53e3\u8fc7\u591a\uff0c\u8bf7\u5148\u5173\u95ed\u4e0d\u9700\u8981\u7684\u7a97\u53e3\u3002",showType:"slide"}):qc.main.mainTabs.tabs("add",{title:a,content:i?qc.main.createFrame(n):null,href:i?null:n,closable:!0}),t=qc.main.mainTabs.tabs("getSelected");i&&null!=t&&(t.addClass("overflow-hide"),t.iframe=i),qc.main.tabClose(),qc.main.tabCloseEven()},qc.main.createFrame=function(a){var n='<iframe class="iframe-fluid" src="'+a+'"></iframe>';return n};var mainTabMenu=$("#mainTabMenu");qc.main.tabClose=function(){var a=$(".tabs-inner"),n=$(".tabs-selected");a.dblclick(function(){var a=$(this).children(".tabs-closable").text();qc.main.mainTabs.tabs("close",a)}),a.mousedown(function(a){if(a.preventDefault(),2==a.which){var n=$(this).children(".tabs-closable").text();return qc.main.mainTabs.tabs("close",n),!1}}),n.mousedown(function(a){if(a.preventDefault(),2==a.which){var n=$(this).children().first().text();return qc.main.mainTabs.tabs("close",n),!1}return!1}),n.bind("contextmenu",function(a){mainTabMenu.menu("show",{left:a.pageX,top:a.pageY});var n=$(this).children().first().text();return mainTabMenu.data("currtab",n),qc.main.mainTabs.tabs("select",n),!1})},qc.main.tabCloseEven=function(){return mainTabMenu.menu({onClick:function(a){qc.main.closeTab(a.id)}}),!1},qc.main.pushWindowId=function(a){qc.main.windowStack.push({title:qc.main.mainTabs.tabs("getSelected").panel("options").title,windows:a.split(",")})},qc.main.destroyContainsWindow=function(a){var n=new Array,e=qc.main.windowStack;if(a&&a.length>0){for(var i=0;i<e.length;i++)if(a.indexOf(e[i].title)>-1)for(var t=e[i].windows,s=0;s<t.length;s++){var c=$("#"+t[s]);c&&(qc.main.destoryWindow=c,c.panel("destroy"))}else n.push(e[i]);qc.main.windowStack=n}},qc.main.closeTab=function(a){var n=qc.main.mainTabs.tabs("tabs"),e=qc.main.mainTabs.tabs("getSelected"),i=e.panel("options").title,t=[],s=[];switch($.each(n,function(a,n){t.push($(n).panel("options").title)}),a){case"refresh":var c;if(i!=qc.main.onlyOpenTitle)if(c=e.children("iframe").src,null!=c&&c.length>0)qc.main.mainTabs.tabs("update",{tab:e,options:{content:e.iframe?qc.main.createFrame(c):null}});else{var r=qc.main.mainTabs.tabs("getSelected");s.push(i),r.panel("refresh")}break;case"close":i!=qc.main.onlyOpenTitle&&(s.push(i),qc.main.mainTabs.tabs("close",i));break;case"closeall":$.each(t,function(a,n){n!=qc.main.onlyOpenTitle&&(qc.main.mainTabs.tabs("close",n),s.push(n))});break;case"closeother":$.each(t,function(a,n){n!=i&&n!=qc.main.onlyOpenTitle&&(qc.main.mainTabs.tabs("close",n),s.push(n))});break;case"closeright":var l=qc.main.mainTabs.tabs("getTabIndex",e);if(l==n.length-1)return $.messager.show({title:"\u63d0\u793a",msg:"\u53f3\u8fb9\u6ca1\u6709\u53ef\u5173\u95ed\u7684\u6807\u7b7e\uff01",timeout:5e3,showType:"slide"}),!1;$.each(t,function(a,n){a>l&&n!=qc.main.onlyOpenTitle&&(qc.main.mainTabs.tabs("close",n),s.push(n))});break;case"closeleft":var l=qc.main.mainTabs.tabs("getTabIndex",e);if(1==l)return $.messager.show({title:"\u63d0\u793a",msg:"\u5de6\u8fb9\u6ca1\u6709\u53ef\u5173\u95ed\u7684\u6807\u7b7e\uff01",timeout:5e3,showType:"slide"}),!1;$.each(t,function(a,n){l>a&&n!=qc.main.onlyOpenTitle&&(qc.main.mainTabs.tabs("close",n),s.push(n))})}qc.main.destroyContainsWindow(s)},qc.main.menushow=function(a){var n=$(".menu > li");$("#"+a.id).addClass("active"),$("div."+a.id).fadeIn();var e=$("div."+a.id+" > iframe").attr("src");(""==e||"#"==e)&&(durl=$("div."+a.id).attr("title"),$("div."+a.id+" > iframe").attr("src",durl));for(var i=0;i<n.length;i++){var t=n[i].id;a.id!=t&&($("#"+t).removeClass("active"),$("div."+t).add("hidden"))}},qc.main.closeThisAndsOpenOther=function(a,n,e){if(qc.main.mainTabs.tabs("exists",n)){qc.main.mainTabs.tabs("close",a),qc.main.mainTabs.tabs("select",n);var i=qc.main.mainTabs.tabs("getSelected"),t=$(i.panel("options").content);src=t.attr("src"),src!=e&&qc.main.mainTabs.tabs("update",{tab:i,options:{content:qc.main.createFrame(e)}})}else{var s=qc.main.mainTabs.tabs("getSelected");qc.main.mainTabs.tabs("update",{tab:s,options:{title:n,content:qc.main.createFrame(e)}})}},qc.main.getCurrentWindow=function(a){var n=a,e=a.lastIndexOf(".");return-1!=e&&(n=a.substring(0,e)),frames[n]},qc.main.msgShow=function(a,n,e){$.messager.alert(a,n,e)};